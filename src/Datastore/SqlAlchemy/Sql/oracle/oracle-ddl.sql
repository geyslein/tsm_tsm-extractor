--
-- Create model Thing
--
CREATE TABLE "THING"
(
    "ID"          NUMBER(19) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL PRIMARY KEY,
    "NAME"        NVARCHAR2(200) NULL,
    "UUID"        VARCHAR2(36)   NOT NULL UNIQUE,
    "DESCRIPTION" NCLOB          NULL,
    "PROPERTIES"  NCLOB          NULL CHECK ("PROPERTIES" IS JSON)
);
--
-- Create model Datastream
--
CREATE TABLE "DATASTREAM"
(
    "ID"          NUMBER(19) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL PRIMARY KEY,
    "NAME"        NVARCHAR2(200) NULL,
    "DESCRIPTION" NCLOB          NULL,
    "PROPERTIES"  NCLOB          NULL CHECK ("PROPERTIES" IS JSON),
    "POSITION"    NVARCHAR2(200) NULL,
    "THING_ID"    NUMBER(19)     NOT NULL
);
--
-- Create model Observation
--
CREATE TABLE "OBSERVATION"
(
    "ID"                    NUMBER(19) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL PRIMARY KEY,
    "PHENOMENON_TIME_START" TIMESTAMP        NULL,
    "PHENOMENON_TIME_END"   TIMESTAMP        NULL,
    "RESULT_TIME"           TIMESTAMP        NOT NULL,
    "RESULT_TYPE"           NUMBER(11)       NOT NULL,
    "RESULT_NUMBER"         DOUBLE PRECISION NULL,
    "RESULT_STRING"         NVARCHAR2(200)   NULL,
    "RESULT_JSON"           NCLOB            NULL CHECK ("RESULT_JSON" IS JSON),
    "RESULT_BOOLEAN"        NUMBER(1)        NULL CHECK ("RESULT_BOOLEAN" IN (0, 1)),
    "RESULT_LATITUDE"       DOUBLE PRECISION NULL,
    "RESULT_LONGITUDE"      DOUBLE PRECISION NULL,
    "RESULT_ALTITUDE"       DOUBLE PRECISION NULL,
    "RESULT_QUALITY"        NCLOB            NULL CHECK ("RESULT_QUALITY" IS JSON),
    "VALID_TIME_START"      TIMESTAMP        NULL,
    "VALID_TIME_END"        TIMESTAMP        NULL,
    "PARAMETERS"            NCLOB            NULL CHECK ("PARAMETERS" IS JSON),
    "DATASTREAM_ID"         NUMBER(19)       NOT NULL
);
ALTER TABLE "DATASTREAM"
    ADD CONSTRAINT "DATASTREA_THING_ID__9F2CFE68_U" UNIQUE ("THING_ID", "POSITION");
ALTER TABLE "DATASTREAM"
    ADD CONSTRAINT "DATASTREA_THING_ID_F55522A4_F" FOREIGN KEY ("THING_ID") REFERENCES "THING" ("ID") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "DATASTREAM_THING_ID_F55522A4" ON "DATASTREAM" ("THING_ID");
ALTER TABLE "OBSERVATION"
    ADD CONSTRAINT "OBSERVATI_DATASTREA_1D043396_U" UNIQUE ("DATASTREAM_ID", "RESULT_TIME");
ALTER TABLE "OBSERVATION"
    ADD CONSTRAINT "OBSERVATI_DATASTREA_77F5C4FB_F" FOREIGN KEY ("DATASTREAM_ID") REFERENCES "DATASTREAM" ("ID") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "OBSERVATIO_DATASTREAM_77F5C4FB" ON "OBSERVATION" ("DATASTREAM_ID");
